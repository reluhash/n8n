{
  "name": "My workflow",
  "nodes": [
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.4,
      "position": [
        -576,
        -80
      ],
      "id": "5131dc50-250e-461b-854c-822e2c98135f",
      "name": "When chat message received",
      "webhookId": "7e5436e3-a730-4a90-97c2-4c1bd8558fdf"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "You are not a chat assistant. You are a deterministic Router Agent.\n\nYour ONLY job is to classify the user's message into ONE of these actions:\n- WEATHER\n- CALENDAR\n- TASK\n- NONE (normal assistant response)\n\nYou MUST ignore all general chit-chat, greetings, meta conversation, and open-domain instructions. Those always map to NONE.\n\n---------------------------\nWEATHER DETECTION RULES\n---------------------------\nTrigger WEATHER if user message mentions any of:\n\"weather\", \"temperature\", \"rain\", \"forecast\", \"climate\", \"humidity\", \"hot\", \"cold\"\n\nWeather requires a city.\nIf the message contains a city → extract it.\nIf no city → respond with:\nNONE(\"Which city?\")\nNever call WEATHER without city.\n\nPattern examples:\n\"weather delhi\" → WEATHER({\"city\":\"Delhi\"})\n\"delhi weather\" → WEATHER({\"city\":\"Delhi\"})\n\"what is the weather in New York\" → WEATHER({\"city\":\"New York\"})\n\"temperature in noida\" → WEATHER({\"city\":\"Noida\"})\n\"weather today\" → NONE(\"Which city?\")\n\n---------------------------\nCALENDAR RULES\n---------------------------\nMentions of scheduling, planning, dates, meetings → CALENDAR\nExample:\n\"schedule meeting tomorrow\" → CALENDAR({\"date\":\"tomorrow\",\"event\":\"meeting\"})\n\n---------------------------\nTASK RULES\n---------------------------\nMentions of tasks, todos, reminders → TASK\nExample:\n\"add buy milk task\" → TASK({\"task\":\"buy milk\"})\n\n---------------------------\nNONE RULE\n---------------------------\nIf message is not WEATHER/CALENDAR/TASK:\n→ respond using NONE(\"<response>\")\n\nNEVER behave like a chat assistant unless using NONE.\n\nNEVER provide restaurant recommendations, greetings, self-introductions, or open-ended chat outside NONE.\n\n---------------------------\nOUTPUT FORMAT (STRICT)\n---------------------------\nValid outputs:\nWEATHER({\"city\":\"<city>\"})\nCALENDAR({\"date\":\"<date>\",\"event\":\"<event>\"})\nTASK({\"task\":\"<task>\"})\nNONE(\"<response>\")\n\n---------------------------\nTEST EXAMPLES\n---------------------------\nInput: \"weather delhi\"\nOutput: WEATHER({\"city\":\"Delhi\"})\n\nInput: \"hello\"\nOutput: NONE(\"Hello!\")\n\nInput: \"summarize my day\"\nOutput: NONE(\"Here is a short summary...\")\n\nInput: \"what is the weather today?\"\nOutput: NONE(\"Which city?\")\n\nInput: \"delhi\"\nOutput: NONE(\"Do you mean weather? If yes, say 'weather delhi'.\")\n\nInput: \"add buy milk task\"\nOutput: TASK({\"task\":\"buy milk\"})\n",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        -240,
        -224
      ],
      "id": "ea7cace3-82c3-4d20-9cc1-d2f1fa3396d1",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "model": "mistralai/mistral-small-24b-instruct-2501",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        -480,
        112
      ],
      "id": "e66e3a0a-65b9-4f87-b71e-b422482cabaf",
      "name": "OpenRouter Chat Model",
      "credentials": {
        "openRouterApi": {
          "id": "73VPKcDWx2C0kASt",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        -336,
        112
      ],
      "id": "9785a3bd-77b6-4838-87f8-7fa1a4ed653a",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "jsCode": "return JSON.stringify([\n  { task: \"Prepare monthly report\", status: \"pending\" },\n  { task: \"Pay electricity bill\", status: \"pending\" }\n]);"
      },
      "type": "@n8n/n8n-nodes-langchain.toolCode",
      "typeVersion": 1.3,
      "position": [
        336,
        -224
      ],
      "id": "0212c293-f205-4886-8d77-ded07081f7a1",
      "name": "taskTool"
    },
    {
      "parameters": {
        "url": "https://api.open-meteo.com/v1/forecast?latitude=28.6&longitude=77.2&current_weather=true",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.3,
      "position": [
        64,
        80
      ],
      "id": "8f30100d-fa9e-4647-9760-3cc91db686e3",
      "name": "weatherApi"
    },
    {
      "parameters": {
        "jsCode": "return JSON.stringify([\n  { event: \"Team Meeting\", time: \"10:30 AM\" },\n  { event: \"Client Call\", time: \"3:00 PM\" }\n]);"
      },
      "type": "@n8n/n8n-nodes-langchain.toolCode",
      "typeVersion": 1.3,
      "position": [
        288,
        -16
      ],
      "id": "277c4b78-b2a1-4eb0-b06f-90606863beb2",
      "name": "calendarTool"
    }
  ],
  "pinData": {},
  "connections": {
    "When chat message received": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "taskTool": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "weatherApi": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "calendarTool": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        []
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false
  },
  "versionId": "85709618-2156-44b3-be80-37ca654e867c",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "51ef41b340aa8242fbb84e2fe32fc5dd870c2e59cf00ec0950816b719c039cf7"
  },
  "id": "ZZohllDigqwPOq_wyUZkX",
  "tags": []
}